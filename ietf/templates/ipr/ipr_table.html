{# bs5ok #}
{# Copyright The IETF Trust 2015, All Rights Reserved #}
{% load origin %}
{% origin %}
{% load ietf_filters %}
<table class="table table-sm table-striped tablesorter ipr-table">
    <thead>
        <tr>
            <th data-sort="date">Date</th>
            <th data-sort="num">ID</th>
            <th data-sort="title">Title</th>
            {% if administrative_list == 'pending' %}
                <th data-sort="query">Query</th>
                <th data-sort="due">Response due</th>
            {% endif %}
        </tr>
    </thead>
    <tbody>
        {% for ipr in iprs %}
            <tr>
                <td class="text-nowrap text-end">{{ ipr.time|date:"Y-m-d" }}</td>
                <td class="text-end">{{ ipr.id }}</td>
                <td>
                    {% if ipr.state_id == 'posted' or administrative_list %}
                        <div>
                            <a href="{% url "ietf.ipr.views.show" ipr.id %}">{{ ipr.title }}</a>
                        </div>
                        {% for item in ipr.relatedipr_source_set.all %}
                            {% if item.target.state_id == 'posted' %}
                                <small>Updates ID
                                    <a href="{% url "ietf.ipr.views.show" item.target.id %}">#{{ item.target.id }}</a>.
                                </small>
                            {% endif %}
                        {% endfor %}
                        {% for item in ipr.relatedipr_target_set.all %}
                            {% if item.source.state_id == "posted" %}
                                <small>Updated by ID
                                    <a href="{% url "ietf.ipr.views.show" item.source.id %}">#{{ item.source.id }}</a>.
                                </small>
                            {% endif %}
                        {% endfor %}
                    {% else %}
                        <div>{{ ipr.title }}</div>
                        <small><i>This IPR disclosure was removed at the request of the submitter.</i></small>
                    {% endif %}
                </td>
                {% if administrative_list == 'pending' %}
                    {% with ipr.get_latest_event_msgout as latest_msgout %}
                        <td>
                            {% if latest_msgout %}{{ latest_msgout.time|date:"Y-m-d" }}{% endif %}
                        </td>
                        <td>
                            {% if latest_msgout and latest_msgout.response_due %}
                                {{ latest_msgout.response_due|date:"Y-m-d" }}
                                {% if latest_msgout.response_past_due %}
                                    <span class="bi bi-exclamation-circle" title="Response overdue"></span>
                                {% endif %}
                            {% endif %}
                        </td>
                    {% endwith %}
                {% endif %}
            </tr>
        {% endfor %}
    </tbody>
</table>